<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>mCode to OMOP Standard Library • mOMOP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="mCode to OMOP Standard Library">
<meta property="og:description" content="mOMOP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">mOMOP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/rmd/omop-mcode-library.html">mCode to OMOP Standard Library</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/meerapatelmd/mOMOP/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>mCode to OMOP Standard Library</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/meerapatelmd/mOMOP/blob/master/vignettes/rmd/omop-mcode-library.Rmd"><code>vignettes/rmd/omop-mcode-library.Rmd</code></a></small>
      <div class="hidden name"><code>omop-mcode-library.Rmd</code></div>

    </div>

    
    
<p>Last updated on: 2021-01-02</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/meerapatelmd/mOMOP">mOMOP</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://meerapatelmd.github.io/chariot/">chariot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/connectAthena.html">connectAthena</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This vignette takes a look at the Value Sets in the mCode Data Dictionary to create the standard library of Oncology concepts, available for loading in this package.</p>
<p>The mCode valuesets are retrieved from the publicly available data dictionary.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">value_sets</span> <span class="op">&lt;-</span> <span class="fu">get_value_sets</span><span class="op">(</span><span class="op">)</span>
<span class="va">value_sets</span></code></pre></div>
<pre><code>## # A tibble: 6,603 x 5
##    `Value Set Name`   `Code System` `Logical Definitio… Code  `Code Description`
##    &lt;chr&gt;              &lt;chr&gt;         &lt;chr&gt;               &lt;chr&gt; &lt;chr&gt;             
##  1 CancerBodyLocatio… SNOMED CT     includes codes des… &lt;NA&gt;  &lt;NA&gt;              
##  2 CancerDiseaseStat… SNOMED CT     &lt;NA&gt;                3636… Imaging (procedur…
##  3 CancerDiseaseStat… SNOMED CT     &lt;NA&gt;                2524… Histopathology te…
##  4 CancerDiseaseStat… SNOMED CT     &lt;NA&gt;                7110… Assessment of sym…
##  5 CancerDiseaseStat… SNOMED CT     &lt;NA&gt;                5880… Physical examinat…
##  6 CancerDiseaseStat… SNOMED CT     &lt;NA&gt;                2507… Tumor marker meas…
##  7 CancerDiseaseStat… SNOMED CT     &lt;NA&gt;                3863… Laboratory data i…
##  8 CancerDisorderVS   ICD-10-CM     &lt;NA&gt;                C000  Malignant neoplas…
##  9 CancerDisorderVS   ICD-10-CM     &lt;NA&gt;                C001  Malignant neoplas…
## 10 CancerDisorderVS   ICD-10-CM     &lt;NA&gt;                C002  Malignant neoplas…
## # … with 6,593 more rows</code></pre>
<p>To map the valuesets to OMOP concepts, it is split by <code>Code System</code>, the equivalent to the <code>vocabulary_id</code> field in OMOP’s Concept table, for joining. As of 2021-01-02, there are 9 <code>Code Systems</code> used in mCode.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">value_sets_by_vocab</span> <span class="op">&lt;-</span> <span class="va">value_sets</span> <span class="op">%&gt;%</span> <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/split_by.html">split_by</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">`Code System`</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">value_sets_by_vocab</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "ClinVar"                                      
## [2] "http://cancerstaging.org"                     
## [3] "http://terminology.hl7.org/CodeSystem/v2-0487"
## [4] "http://unitsofmeasure.org"                    
## [5] "http://varnomen.hgvs.org"                     
## [6] "http://www.genenames.org/geneId"              
## [7] "ICD-10-CM"                                    
## [8] "LOINC"                                        
## [9] "SNOMED CT"</code></pre>
<div id="specimen" class="section level2">
<h2 class="hasAnchor">
<a href="#specimen" class="anchor"></a>Specimen</h2>
<p>In mCode, Specimen representation is based on HL7’s Code System while in OMOP, the Specimen domain has its own subset of concepts. Furthermore, mCode’s<br>
Specimen representation maps to other OMOP Concept Ids. The Specimen representation in this package therefore has 2 parts:</p>
<ol style="list-style-type: decimal">
<li>A map between mCode and OMOP Concepts outside OMOP’s Specimen domain<br>
</li>
<li>OMOP’s Specimen domain concepts</li>
</ol>
<div id="map-from-mcode-to-omop" class="section level3">
<h3 class="hasAnchor">
<a href="#map-from-mcode-to-omop" class="anchor"></a>Map from mCode to OMOP</h3>
<p>Specimen representation is derived from the valuesets.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">specimen_library</span> <span class="op">&lt;-</span> <span class="va">value_sets_by_vocab</span><span class="op">$</span><span class="va">`http://terminology.hl7.org/CodeSystem/v2-0487`</span> <span class="op">%&gt;%</span> 
    <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/format_colnames.html">format_colnames</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">specimen_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   value_set_name   code_system           logical_definit… code  code_description
##   &lt;chr&gt;            &lt;chr&gt;                 &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;           
## 1 GeneticSpecimen… http://terminology.h… &lt;NA&gt;             AMN   Amniotic fluid  
## 2 GeneticSpecimen… http://terminology.h… &lt;NA&gt;             BIFL  Bile Fluid      
## 3 GeneticSpecimen… http://terminology.h… &lt;NA&gt;             BLD   Whole blood     
## 4 GeneticSpecimen… http://terminology.h… &lt;NA&gt;             BLDA  Blood arterial  
## 5 GeneticSpecimen… http://terminology.h… &lt;NA&gt;             BLDCO Cord blood      
## 6 GeneticSpecimen… http://terminology.h… &lt;NA&gt;             BLDV  Blood venous</code></pre>
<p>The specimen description is joined on the Concept Synonym Names in the Concept Synonym table to retrieve the Concept Id the mCode Specimen maps to.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">specimen_omop_library1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/join_on_concept_synonym_name.html">join_on_concept_synonym_name</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">specimen_library</span>, 
    column <span class="op">=</span> <span class="st">"code_description"</span>, case_insensitive <span class="op">=</span> <span class="cn">TRUE</span>, conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">concept_synonym_name</span>, <span class="op">-</span><span class="va">language_concept_id</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">rename</span><span class="op">(</span>match_concept_id <span class="op">=</span> <span class="va">concept_id</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">specimen_omop_library1</span><span class="op">)</span></code></pre></div>
<pre><code>##          value_set_name                                   code_system
## 1 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 2 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 3 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 4 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 5 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 6 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
##   logical_definition code code_description match_concept_id
## 1               &lt;NA&gt;  SKN             Skin          1027716
## 2               &lt;NA&gt;  PLC         Placenta          1032268
## 3               &lt;NA&gt;  SAL           Saliva          1033195
## 4               &lt;NA&gt;  SPT           Sputum          1033465
## 5               &lt;NA&gt;  WND            Wound          1033739
## 6               &lt;NA&gt;  BON             Bone          1585831</code></pre>
<p>The complete Concept representation is taken from the Concept Id.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">specimen_omop_library2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/join_on_concept_id.html">join_on_concept_id</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">specimen_omop_library1</span>, 
    column <span class="op">=</span> <span class="st">"match_concept_id"</span>, conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">specimen_omop_library2</span><span class="op">)</span></code></pre></div>
<pre><code>##          value_set_name                                   code_system
## 1 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 2 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 3 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 4 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 5 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
## 6 GeneticSpecimenTypeVS http://terminology.hl7.org/CodeSystem/v2-0487
##   logical_definition code code_description match_concept_id concept_id
## 1               &lt;NA&gt;  SKN             Skin          1027716    1027716
## 2               &lt;NA&gt;  PLC         Placenta          1032268    1032268
## 3               &lt;NA&gt;  SAL           Saliva          1033195    1033195
## 4               &lt;NA&gt;  SPT           Sputum          1033465    1033465
## 5               &lt;NA&gt;  WND            Wound          1033739    1033739
## 6               &lt;NA&gt;  BON             Bone          1585831    1585831
##                         concept_name   domain_id vocabulary_id concept_class_id
## 1                               Skin Observation         LOINC     LOINC System
## 2                           Placenta Observation         LOINC     LOINC System
## 3                             Saliva Observation         LOINC     LOINC System
## 4                             Sputum Observation         LOINC     LOINC System
## 5                              Wound Observation         LOINC     LOINC System
## 6 Organ Transplant Description: Bone Observation           PPI           Answer
##   standard_concept                    concept_code valid_start_date
## 1             &lt;NA&gt;                       LP36760-4       1970-01-01
## 2             &lt;NA&gt;                        LP7477-5       1970-01-01
## 3             &lt;NA&gt;                        LP7565-7       1970-01-01
## 4             &lt;NA&gt;                        LP7600-2       1970-01-01
## 5             &lt;NA&gt;                        LP7726-5       1970-01-01
## 6             &lt;NA&gt; OrganTransplantDescription_Bone       2017-05-17
##   valid_end_date invalid_reason
## 1     2099-12-31           &lt;NA&gt;
## 2     2099-12-31           &lt;NA&gt;
## 3     2099-12-31           &lt;NA&gt;
## 4     2099-12-31           &lt;NA&gt;
## 5     2099-12-31           &lt;NA&gt;
## 6     2099-12-31           &lt;NA&gt;</code></pre>
<p>To maintain a one-to-one representation of the original grain of information, the OMOP mappings are pivoted on the OMOP Domain to see how each mCode Specimen maps to by domain.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">specimen_omop_library3</span> <span class="op">&lt;-</span> <span class="va">specimen_omop_library2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/merge_strip.html">merge_strip</a></span><span class="op">(</span>into <span class="op">=</span> <span class="st">"concept"</span>, 
    <span class="va">domain_id</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pivot_wider</span><span class="op">(</span>id_cols <span class="op">=</span> <span class="op">!</span><span class="va">concept</span>, names_from <span class="op">=</span> <span class="va">domain_id</span>, 
    values_from <span class="op">=</span> <span class="va">concept</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">match_concept_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">specimen_omop_library3</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 14
##   concept_id value_set_name code_system logical_definit… code  code_description
##        &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;           
## 1    1027716 GeneticSpecim… http://ter… &lt;NA&gt;             SKN   Skin            
## 2    1032268 GeneticSpecim… http://ter… &lt;NA&gt;             PLC   Placenta        
## 3    1033195 GeneticSpecim… http://ter… &lt;NA&gt;             SAL   Saliva          
## 4    1033465 GeneticSpecim… http://ter… &lt;NA&gt;             SPT   Sputum          
## 5    1033739 GeneticSpecim… http://ter… &lt;NA&gt;             WND   Wound           
## 6    1585831 GeneticSpecim… http://ter… &lt;NA&gt;             BON   Bone            
## # … with 8 more variables: Observation &lt;chr&gt;, Condition &lt;chr&gt;, `Spec Anatomic
## #   Site` &lt;chr&gt;, Drug &lt;chr&gt;, `Meas Value` &lt;chr&gt;, Measurement &lt;chr&gt;,
## #   Specimen &lt;chr&gt;, `NA` &lt;chr&gt;</code></pre>
<p>To gather a complete representation of Specimens, any missing Specimen concepts in OMOP are added to the library.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">omop_specimen</span> <span class="op">&lt;-</span> <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/queryAthena.html">queryAthena</a></span><span class="op">(</span><span class="st">"SELECT *
                     FROM omop_vocabulary.concept 
                     WHERE domain_id = 'Specimen' AND concept_class_id = 'Specimen';"</span>, 
    conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/merge_strip.html">merge_strip</a></span><span class="op">(</span>into <span class="op">=</span> <span class="st">"Specimen"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">Specimen_id</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">omop_specimen</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 1
##   Specimen                                                                      
##   &lt;chr&gt;                                                                         
## 1 [V] [S] 759813 Physical object specimen [SNOMED 1021000124109] [Specimen] [Sp…
## 2 [V] [S] 759820 Paper specimen [SNOMED 1031000124107] [Specimen] [Specimen]    
## 3 [V] [S] 759825 Writing paper specimen [SNOMED 1041000124102] [Specimen] [Spec…
## 4 [V] [S] 759826 Envelope specimen [SNOMED 1051000124100] [Specimen] [Specimen] 
## 5 [V] [S] 759829 Package specimen [SNOMED 1061000124103] [Specimen] [Specimen]  
## 6 [V] [S] 759869 Clothing specimen [SNOMED 1071000124105] [Specimen] [Specimen]</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">specimen_omop_library</span> <span class="op">&lt;-</span> <span class="va">specimen_omop_library3</span> <span class="op">%&gt;%</span> <span class="fu">full_join</span><span class="op">(</span><span class="va">omop_specimen</span>, 
    by <span class="op">=</span> <span class="st">"Specimen"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">specimen_omop_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 14
##   concept_id value_set_name code_system logical_definit… code  code_description
##        &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;           
## 1    1027716 GeneticSpecim… http://ter… &lt;NA&gt;             SKN   Skin            
## 2    1032268 GeneticSpecim… http://ter… &lt;NA&gt;             PLC   Placenta        
## 3    1033195 GeneticSpecim… http://ter… &lt;NA&gt;             SAL   Saliva          
## 4    1033465 GeneticSpecim… http://ter… &lt;NA&gt;             SPT   Sputum          
## 5    1033739 GeneticSpecim… http://ter… &lt;NA&gt;             WND   Wound           
## 6    1585831 GeneticSpecim… http://ter… &lt;NA&gt;             BON   Bone            
## # … with 8 more variables: Observation &lt;chr&gt;, Condition &lt;chr&gt;, `Spec Anatomic
## #   Site` &lt;chr&gt;, Drug &lt;chr&gt;, `Meas Value` &lt;chr&gt;, Measurement &lt;chr&gt;,
## #   Specimen &lt;chr&gt;, `NA` &lt;chr&gt;</code></pre>
<p>This file is written to the <code>data-raw/</code> folder for distribution if it does not already exist.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"specimen.csv"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">specimen_omop_library</span>, file <span class="op">=</span> <span class="va">file</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Error in open.connection(file, "wb"): cannot open the connection</code></pre>
</div>
</div>
<div id="cancer-staging" class="section level2">
<h2 class="hasAnchor">
<a href="#cancer-staging" class="anchor"></a>Cancer Staging</h2>
<p>mCode uses the AJCC TNM Staging system, which correlates with NCIt concepts in the OMOP vocabulary.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cancer_staging_library</span> <span class="op">&lt;-</span> <span class="va">value_sets_by_vocab</span><span class="op">$</span><span class="va">`http://cancerstaging.org`</span> <span class="op">%&gt;%</span> 
    <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/format_colnames.html">format_colnames</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cancer_staging_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   value_set_name    code_system    logical_definition     code  code_description
##   &lt;chr&gt;             &lt;chr&gt;          &lt;chr&gt;                  &lt;chr&gt; &lt;chr&gt;           
## 1 TNMDistantMetast… http://cancer… includes codes from c… &lt;NA&gt;  &lt;NA&gt;            
## 2 TNMPrimaryTumorC… http://cancer… includes codes from c… &lt;NA&gt;  &lt;NA&gt;            
## 3 TNMRegionalNodes… http://cancer… includes codes from c… &lt;NA&gt;  &lt;NA&gt;            
## 4 TNMStageGroupVS   http://cancer… includes codes from c… &lt;NA&gt;  &lt;NA&gt;</code></pre>
<p>As it is represented in the OMOP Vocabulary, NCIt is not separated by Tumor, Node, and Metastasis like it is in mCode.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ncit_omop_library</span> <span class="op">&lt;-</span> <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/queryAthena.html">queryAthena</a></span><span class="op">(</span><span class="st">"SELECT *
                     FROM omop_vocabulary.concept 
                     WHERE vocabulary_id = 'NCIt' AND concept_class_id = 'AJCC Category';"</span>, 
    conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ncit_omop_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   concept_id concept_name domain_id vocabulary_id concept_class_id
##        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
## 1    1537692 Vulvar Canc… Measurem… NCIt          AJCC Category   
## 2    1537693 Retinoblast… Measurem… NCIt          AJCC Category   
## 3    1537694 Vulvar Canc… Measurem… NCIt          AJCC Category   
## 4    1537695 Nasopharyng… Measurem… NCIt          AJCC Category   
## 5    1537700 Adrenal Cor… Measurem… NCIt          AJCC Category   
## 6    1537780 Retinoblast… Measurem… NCIt          AJCC Category   
## # … with 5 more variables: standard_concept &lt;chr&gt;, concept_code &lt;chr&gt;,
## #   valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;, invalid_reason &lt;chr&gt;</code></pre>
<p>NCIt <code>AJCC Category</code> concepts are therefore grouped based on pattern matching with the Concept Code.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ncit_omop_library2</span> <span class="op">&lt;-</span> <span class="va">ncit_omop_library</span>
<span class="va">ncit_omop_library2</span><span class="op">$</span><span class="va">value_set_name</span> <span class="op">&lt;-</span> <span class="st">""</span>
<span class="va">ncit_omop_library2</span> <span class="op">&lt;-</span> <span class="va">ncit_omop_library2</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>value_set_name <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^[cp]{1}M"</span>, 
    <span class="va">concept_code</span><span class="op">)</span> <span class="op">~</span> <span class="st">"TNMDistantMetastasesCategoryVS"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^[cp]{1}N"</span>, 
    <span class="va">concept_code</span><span class="op">)</span> <span class="op">~</span> <span class="st">"TNMRegionalNodesCategoryVS"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^[cp]{1}T"</span>, 
    <span class="va">concept_code</span><span class="op">)</span> <span class="op">~</span> <span class="st">"TNMPrimaryTumorCategoryVS"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ncit_omop_library2</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   concept_id concept_name domain_id vocabulary_id concept_class_id
##        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
## 1    1537692 Vulvar Canc… Measurem… NCIt          AJCC Category   
## 2    1537693 Retinoblast… Measurem… NCIt          AJCC Category   
## 3    1537694 Vulvar Canc… Measurem… NCIt          AJCC Category   
## 4    1537695 Nasopharyng… Measurem… NCIt          AJCC Category   
## 5    1537700 Adrenal Cor… Measurem… NCIt          AJCC Category   
## 6    1537780 Retinoblast… Measurem… NCIt          AJCC Category   
## # … with 6 more variables: standard_concept &lt;chr&gt;, concept_code &lt;chr&gt;,
## #   valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;, invalid_reason &lt;chr&gt;,
## #   value_set_name &lt;chr&gt;</code></pre>
<p>A correlate to mCode’s <code>TNMStageGroupVS</code> value set is not present in the OMOP Vocabularies, but since it can be derived from the TNM categories, it is skipped.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cancer_staging_omop_library</span> <span class="op">&lt;-</span> <span class="va">cancer_staging_library</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">ncit_omop_library2</span>, 
    by <span class="op">=</span> <span class="st">"value_set_name"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cancer_staging_omop_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 15
##   value_set_name code_system logical_definit… code  code_description concept_id
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
## 1 TNMDistantMet… http://can… includes codes … &lt;NA&gt;  &lt;NA&gt;                1537692
## 2 TNMDistantMet… http://can… includes codes … &lt;NA&gt;  &lt;NA&gt;                1537780
## 3 TNMDistantMet… http://can… includes codes … &lt;NA&gt;  &lt;NA&gt;                1537798
## 4 TNMDistantMet… http://can… includes codes … &lt;NA&gt;  &lt;NA&gt;                1537804
## 5 TNMDistantMet… http://can… includes codes … &lt;NA&gt;  &lt;NA&gt;                1537805
## 6 TNMDistantMet… http://can… includes codes … &lt;NA&gt;  &lt;NA&gt;                1537808
## # … with 9 more variables: concept_name &lt;chr&gt;, domain_id &lt;chr&gt;,
## #   vocabulary_id &lt;chr&gt;, concept_class_id &lt;chr&gt;, standard_concept &lt;chr&gt;,
## #   concept_code &lt;chr&gt;, valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;,
## #   invalid_reason &lt;chr&gt;</code></pre>
<p>This data is written to a <code>cancer_staging.csv</code> in the <code>data-raw/</code> folder for distribution if it does not already exist.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"cancer_staging.csv"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cancer_staging_omop_library</span>, file <span class="op">=</span> <span class="va">file</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Error in open.connection(file, "wb"): cannot open the connection</code></pre>
</div>
<div id="genomics" class="section level2">
<h2 class="hasAnchor">
<a href="#genomics" class="anchor"></a>Genomics</h2>
<p>HGVS, HGNC, and ClinVar are collapsed into a single <code>Genomics</code> category.</p>
<div id="hgvs" class="section level3">
<h3 class="hasAnchor">
<a href="#hgvs" class="anchor"></a>HGVS</h3>
<p>mCode uses HGVS (<a href="http://varnomen.hgvs.org" class="uri">http://varnomen.hgvs.org</a>), but these codes are not in the OMOP Vocabulary and cannot be derived from the website. Therefore, it is skipped for now.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hgvs_library</span> <span class="op">&lt;-</span> <span class="va">value_sets_by_vocab</span><span class="op">$</span><span class="va">`http://varnomen.hgvs.org`</span> <span class="op">%&gt;%</span> 
    <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/format_colnames.html">format_colnames</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">hgvs_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   value_set_name code_system      logical_definition      code  code_description
##   &lt;chr&gt;          &lt;chr&gt;            &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;           
## 1 HGVSVS         http://varnomen… All codes in http://va… &lt;NA&gt;  &lt;NA&gt;</code></pre>
</div>
<div id="hgnc" class="section level3">
<h3 class="hasAnchor">
<a href="#hgnc" class="anchor"></a>HGNC</h3>
<p>Gene Names in mCode are presumed to be derived from HGNC and the entire HGNC subset of the OMOP Vocabularies are included in the library.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hgnc_library</span> <span class="op">&lt;-</span> <span class="va">value_sets_by_vocab</span><span class="op">$</span><span class="va">`http://www.genenames.org/geneId`</span> <span class="op">%&gt;%</span> 
    <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/format_colnames.html">format_colnames</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">hgnc_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   value_set_name code_system      logical_definition      code  code_description
##   &lt;chr&gt;          &lt;chr&gt;            &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;           
## 1 HGNCVS         http://www.gene… All codes in http://ww… &lt;NA&gt;  &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hgnc_omop_library1</span> <span class="op">&lt;-</span> <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/queryAthena.html">queryAthena</a></span><span class="op">(</span><span class="st">"SELECT *
                     FROM omop_vocabulary.concept 
                     WHERE vocabulary_id = 'HGNC';"</span>, 
    conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">hgnc_omop_library1</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   concept_id concept_name domain_id vocabulary_id concept_class_id
##        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
## 1   35944910 CCDC77 (coi… Measurem… HGNC          Gene            
## 2   35944911 INMT (indol… Measurem… HGNC          Gene            
## 3   35944912 ZNF117 (zin… Measurem… HGNC          Gene            
## 4   35944913 CKAP2 (cyto… Measurem… HGNC          Gene            
## 5   35944914 ITPRIPL2 (I… Measurem… HGNC          Gene            
## 6   35944916 PEX19 (pero… Measurem… HGNC          Gene            
## # … with 5 more variables: standard_concept &lt;chr&gt;, concept_code &lt;chr&gt;,
## #   valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;, invalid_reason &lt;chr&gt;</code></pre>
<p>The OMOP HGNC concepts are joined to the mCode data dictionary set.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hgnc_omop_library2</span> <span class="op">&lt;-</span> <span class="va">hgnc_omop_library1</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>value_set_name <span class="op">=</span> <span class="st">"HGNCVS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">hgnc_omop_library2</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   concept_id concept_name domain_id vocabulary_id concept_class_id
##        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
## 1   35944910 CCDC77 (coi… Measurem… HGNC          Gene            
## 2   35944911 INMT (indol… Measurem… HGNC          Gene            
## 3   35944912 ZNF117 (zin… Measurem… HGNC          Gene            
## 4   35944913 CKAP2 (cyto… Measurem… HGNC          Gene            
## 5   35944914 ITPRIPL2 (I… Measurem… HGNC          Gene            
## 6   35944916 PEX19 (pero… Measurem… HGNC          Gene            
## # … with 6 more variables: standard_concept &lt;chr&gt;, concept_code &lt;chr&gt;,
## #   valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;, invalid_reason &lt;chr&gt;,
## #   value_set_name &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hgnc_omop_library</span> <span class="op">&lt;-</span> <span class="va">hgnc_library</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">hgnc_omop_library2</span>, 
    by <span class="op">=</span> <span class="st">"value_set_name"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">hgnc_omop_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 15
##   value_set_name code_system logical_definit… code  code_description concept_id
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
## 1 HGNCVS         http://www… All codes in ht… &lt;NA&gt;  &lt;NA&gt;               35944910
## 2 HGNCVS         http://www… All codes in ht… &lt;NA&gt;  &lt;NA&gt;               35944911
## 3 HGNCVS         http://www… All codes in ht… &lt;NA&gt;  &lt;NA&gt;               35944912
## 4 HGNCVS         http://www… All codes in ht… &lt;NA&gt;  &lt;NA&gt;               35944913
## 5 HGNCVS         http://www… All codes in ht… &lt;NA&gt;  &lt;NA&gt;               35944914
## 6 HGNCVS         http://www… All codes in ht… &lt;NA&gt;  &lt;NA&gt;               35944916
## # … with 9 more variables: concept_name &lt;chr&gt;, domain_id &lt;chr&gt;,
## #   vocabulary_id &lt;chr&gt;, concept_class_id &lt;chr&gt;, standard_concept &lt;chr&gt;,
## #   concept_code &lt;chr&gt;, valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;,
## #   invalid_reason &lt;chr&gt;</code></pre>
</div>
<div id="clinvar" class="section level3">
<h3 class="hasAnchor">
<a href="#clinvar" class="anchor"></a>ClinVar</h3>
<p>Like HGNC, the entire ClinVar subset of the OMOP Vocabularies are included in the library.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clinvar_library</span> <span class="op">&lt;-</span> <span class="va">value_sets_by_vocab</span><span class="op">$</span><span class="va">ClinVar</span> <span class="op">%&gt;%</span> <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/format_colnames.html">format_colnames</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">clinvar_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   value_set_name code_system logical_definition          code  code_description
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;                       &lt;chr&gt; &lt;chr&gt;           
## 1 ClinVarVS      ClinVar     Includes codes from ClinVar &lt;NA&gt;  &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clinvar_omop_library1</span> <span class="op">&lt;-</span> <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/queryAthena.html">queryAthena</a></span><span class="op">(</span><span class="st">"SELECT *
                     FROM omop_vocabulary.concept 
                     WHERE vocabulary_id = 'ClinVar';"</span>, 
    conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">clinvar_omop_library1</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   concept_id concept_name domain_id vocabulary_id concept_class_id
##        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
## 1   35968119 NC_000002.1… Measurem… ClinVar       Variant         
## 2   35968121 NM_000038.6… Measurem… ClinVar       Variant         
## 3   35968122 NM_000038.6… Measurem… ClinVar       Variant         
## 4   35968123 NM_000038.6… Measurem… ClinVar       Variant         
## 5   35968124 NM_000038.6… Measurem… ClinVar       Variant         
## 6   35968125 NM_000038.6… Measurem… ClinVar       Variant         
## # … with 5 more variables: standard_concept &lt;chr&gt;, concept_code &lt;chr&gt;,
## #   valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;, invalid_reason &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clinvar_omop_library2</span> <span class="op">&lt;-</span> <span class="va">clinvar_omop_library1</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>value_set_name <span class="op">=</span> <span class="st">"ClinVarVS"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">clinvar_omop_library2</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   concept_id concept_name domain_id vocabulary_id concept_class_id
##        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
## 1   35968119 NC_000002.1… Measurem… ClinVar       Variant         
## 2   35968121 NM_000038.6… Measurem… ClinVar       Variant         
## 3   35968122 NM_000038.6… Measurem… ClinVar       Variant         
## 4   35968123 NM_000038.6… Measurem… ClinVar       Variant         
## 5   35968124 NM_000038.6… Measurem… ClinVar       Variant         
## 6   35968125 NM_000038.6… Measurem… ClinVar       Variant         
## # … with 6 more variables: standard_concept &lt;chr&gt;, concept_code &lt;chr&gt;,
## #   valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;, invalid_reason &lt;chr&gt;,
## #   value_set_name &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clinvar_omop_library</span> <span class="op">&lt;-</span> <span class="va">clinvar_library</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">clinvar_omop_library2</span>, 
    by <span class="op">=</span> <span class="st">"value_set_name"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">clinvar_omop_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 15
##   value_set_name code_system logical_definit… code  code_description concept_id
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
## 1 ClinVarVS      ClinVar     Includes codes … &lt;NA&gt;  &lt;NA&gt;               35968119
## 2 ClinVarVS      ClinVar     Includes codes … &lt;NA&gt;  &lt;NA&gt;               35968121
## 3 ClinVarVS      ClinVar     Includes codes … &lt;NA&gt;  &lt;NA&gt;               35968122
## 4 ClinVarVS      ClinVar     Includes codes … &lt;NA&gt;  &lt;NA&gt;               35968123
## 5 ClinVarVS      ClinVar     Includes codes … &lt;NA&gt;  &lt;NA&gt;               35968124
## 6 ClinVarVS      ClinVar     Includes codes … &lt;NA&gt;  &lt;NA&gt;               35968125
## # … with 9 more variables: concept_name &lt;chr&gt;, domain_id &lt;chr&gt;,
## #   vocabulary_id &lt;chr&gt;, concept_class_id &lt;chr&gt;, standard_concept &lt;chr&gt;,
## #   concept_code &lt;chr&gt;, valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;,
## #   invalid_reason &lt;chr&gt;</code></pre>
</div>
<div id="final-genomics-library" class="section level3">
<h3 class="hasAnchor">
<a href="#final-genomics-library" class="anchor"></a>Final Genomics Library</h3>
<p>The final genomics library file is written if it does not already exist.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genomics_omop_library</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">hgnc_omop_library</span>, <span class="va">clinvar_omop_library</span><span class="op">)</span>
<span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"genomics.csv"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">genomics_omop_library</span>, file <span class="op">=</span> <span class="va">file</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Error in open.connection(file, "wb"): cannot open the connection</code></pre>
</div>
</div>
<div id="units-of-measure" class="section level2">
<h2 class="hasAnchor">
<a href="#units-of-measure" class="anchor"></a>Units of Measure</h2>
<p>Like Specimen, the Units of Measure representation is limited and requires incorporation of the OMOP <code>UCUM</code> vocabulary valueset.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">uom_library</span> <span class="op">&lt;-</span> <span class="va">value_sets_by_vocab</span><span class="op">$</span><span class="va">`http://unitsofmeasure.org`</span> <span class="op">%&gt;%</span> 
    <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/format_colnames.html">format_colnames</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">uom_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   value_set_name  code_system           logical_definiti… code  code_description
##   &lt;chr&gt;           &lt;chr&gt;                 &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;           
## 1 UnitsOfLengthVS http://unitsofmeasur… &lt;NA&gt;              pm    Picometer       
## 2 UnitsOfLengthVS http://unitsofmeasur… &lt;NA&gt;              nm    Nanometer       
## 3 UnitsOfLengthVS http://unitsofmeasur… &lt;NA&gt;              mm    Millimeter      
## 4 UnitsOfLengthVS http://unitsofmeasur… &lt;NA&gt;              cm    Centimeter      
## 5 UnitsOfLengthVS http://unitsofmeasur… &lt;NA&gt;              m     Meter           
## 6 UnitsOfLengthVS http://unitsofmeasur… &lt;NA&gt;              ft-us Foot</code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ucum_omop_library1</span> <span class="op">&lt;-</span> <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/queryAthena.html">queryAthena</a></span><span class="op">(</span><span class="st">"SELECT *
                     FROM omop_vocabulary.concept 
                     WHERE vocabulary_id = 'UCUM';"</span>, 
    conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ucum_omop_library1</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   concept_id concept_name domain_id vocabulary_id concept_class_id
##        &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;           
## 1       8478 avidity ind… Unit      UCUM          Unit            
## 2       8479 centipoise   Unit      UCUM          Unit            
## 3       8480 Ehrlich unit Unit      UCUM          Unit            
## 4       8481 EV           Unit      UCUM          Unit            
## 5       8482 pH           Unit      UCUM          Unit            
## 6       8483 counts per … Unit      UCUM          Unit            
## # … with 5 more variables: standard_concept &lt;chr&gt;, concept_code &lt;chr&gt;,
## #   valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;, invalid_reason &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">uom_omop_library</span> <span class="op">&lt;-</span> <span class="va">uom_library</span> <span class="op">%&gt;%</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">ucum_omop_library1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">uom_omop_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 15
##   value_set_name code_system logical_definit… code  code_description concept_id
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
## 1 UnitsOfLength… http://uni… &lt;NA&gt;             pm    Picometer                NA
## 2 UnitsOfLength… http://uni… &lt;NA&gt;             nm    Nanometer                NA
## 3 UnitsOfLength… http://uni… &lt;NA&gt;             mm    Millimeter               NA
## 4 UnitsOfLength… http://uni… &lt;NA&gt;             cm    Centimeter               NA
## 5 UnitsOfLength… http://uni… &lt;NA&gt;             m     Meter                    NA
## 6 UnitsOfLength… http://uni… &lt;NA&gt;             ft-us Foot                     NA
## # … with 9 more variables: concept_name &lt;chr&gt;, domain_id &lt;chr&gt;,
## #   vocabulary_id &lt;chr&gt;, concept_class_id &lt;chr&gt;, standard_concept &lt;chr&gt;,
## #   concept_code &lt;chr&gt;, valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;,
## #   invalid_reason &lt;chr&gt;</code></pre>
<p>Write the data to a file if it does not already exist.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"unitsofmeasurement.csv"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">uom_omop_library</span>, file <span class="op">=</span> <span class="va">file</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Error in open.connection(file, "wb"): cannot open the connection</code></pre>
</div>
<div id="snomed" class="section level2">
<h2 class="hasAnchor">
<a href="#snomed" class="anchor"></a>SNOMED</h2>
<p>The SNOMED subset of the library contains:</p>
<ul>
<li>Explicitly stated concepts<br>
</li>
<li>Concepts that are descendants of a stated code<br>
</li>
<li>Concepts that are ancestors of a stated code</li>
</ul>
<p>To derive all concepts, the code in the <code>logical_definition</code> field is extracted based on the listed scenario above.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">snomed_library</span> <span class="op">&lt;-</span> <span class="va">value_sets_by_vocab</span><span class="op">$</span><span class="va">`SNOMED CT`</span> <span class="op">%&gt;%</span> <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/format_colnames.html">format_colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate_all</span><span class="op">(</span><span class="va">as.character</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">extract</span><span class="op">(</span>col <span class="op">=</span> <span class="va">logical_definition</span>, 
    into <span class="op">=</span> <span class="st">"descendants_of"</span>, regex <span class="op">=</span> <span class="st">"includes codes descending from ([0-9]{1,})[^0-9]{1}.*$"</span>, 
    remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">extract</span><span class="op">(</span>col <span class="op">=</span> <span class="va">logical_definition</span>, into <span class="op">=</span> <span class="st">"ancestors_of"</span>, 
    regex <span class="op">=</span> <span class="st">"excludes codes descending from ([0-9]{1,})[^0-9]{1}.*$"</span>, 
    remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>all_codes <span class="op">=</span> <span class="fu">coalesce</span><span class="op">(</span><span class="va">code</span>, <span class="va">ancestors_of</span>, 
    <span class="va">descendants_of</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate_all</span><span class="op">(</span><span class="va">trimws</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">snomed_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##   value_set_name code_system logical_definit… ancestors_of descendants_of code 
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;          &lt;chr&gt;
## 1 CancerBodyLoc… SNOMED CT   includes codes … &lt;NA&gt;         123037004      &lt;NA&gt; 
## 2 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           3636…
## 3 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           2524…
## 4 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           7110…
## 5 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           5880…
## 6 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           2507…
## # … with 2 more variables: code_description &lt;chr&gt;, all_codes &lt;chr&gt;</code></pre>
<p>OMOP Concept table is joined to the mCode’s SNOMED library by code.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">snomed_omop_library1</span> <span class="op">&lt;-</span> <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/join_on_concept_code.html">join_on_concept_code</a></span><span class="op">(</span>kind <span class="op">=</span> <span class="st">"LEFT"</span>, 
    data <span class="op">=</span> <span class="va">snomed_library</span>, column <span class="op">=</span> <span class="st">"all_codes"</span>, where_in_concept_field <span class="op">=</span> <span class="st">"vocabulary_id"</span>, 
    where_in_concept_field_value <span class="op">=</span> <span class="st">"SNOMED"</span><span class="op">)</span>
<span class="va">snomed_omop_library1</span> <span class="op">&lt;-</span> <span class="va">snomed_library</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">snomed_omop_library1</span>, 
    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"value_set_name"</span>, <span class="st">"ancestors_of"</span>, <span class="st">"descendants_of"</span>, 
        <span class="st">"all_codes"</span>, <span class="st">"code_system"</span>, <span class="st">"logical_definition"</span>, <span class="st">"code"</span>, 
        <span class="st">"code_description"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">snomed_omop_library1</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 18
##   value_set_name code_system logical_definit… ancestors_of descendants_of code 
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;          &lt;chr&gt;
## 1 CancerBodyLoc… SNOMED CT   includes codes … &lt;NA&gt;         123037004      &lt;NA&gt; 
## 2 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           3636…
## 3 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           2524…
## 4 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           7110…
## 5 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           5880…
## 6 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           2507…
## # … with 12 more variables: code_description &lt;chr&gt;, all_codes &lt;chr&gt;,
## #   concept_id &lt;dbl&gt;, concept_name &lt;chr&gt;, domain_id &lt;chr&gt;, vocabulary_id &lt;chr&gt;,
## #   concept_class_id &lt;chr&gt;, standard_concept &lt;chr&gt;, concept_code &lt;chr&gt;,
## #   valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;, invalid_reason &lt;chr&gt;</code></pre>
<p>The resultset is then split into 3 based on whether the descendants (a) or ancestors (b) need to be derived, or if the concept is explicitly stated by code (c).</p>
<p>The descendants are derived for those mCode concepts that included descendants.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">snomed_omop_library2a</span> <span class="op">&lt;-</span> <span class="va">snomed_omop_library1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">descendants_of</span><span class="op">)</span><span class="op">)</span>
<span class="va">snomed_omop_library2a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/join_for_descendants.html">join_for_descendants</a></span><span class="op">(</span>kind <span class="op">=</span> <span class="st">"LEFT"</span>, 
    data <span class="op">=</span> <span class="va">snomed_omop_library2a</span>, ancestor_id_column <span class="op">=</span> <span class="st">"concept_id"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">select</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">snomed_library</span><span class="op">)</span><span class="op">)</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"descendant_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">rename_all</span><span class="op">(</span><span class="op">~</span><span class="fu">str_remove_all</span><span class="op">(</span><span class="va">.</span>, pattern <span class="op">=</span> <span class="st">"^descendant_"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">snomed_omop_library2a2</span><span class="op">)</span></code></pre></div>
<pre><code>##         value_set_name code_system
## 1 CancerBodyLocationVS   SNOMED CT
## 2 CancerBodyLocationVS   SNOMED CT
## 3 CancerBodyLocationVS   SNOMED CT
## 4 CancerBodyLocationVS   SNOMED CT
## 5 CancerBodyLocationVS   SNOMED CT
## 6 CancerBodyLocationVS   SNOMED CT
##                                          logical_definition ancestors_of
## 1 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 2 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 3 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 4 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 5 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 6 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
##   descendants_of code code_description all_codes concept_id
## 1      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004    4048384
## 2      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004    4002852
## 3      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004   36717763
## 4      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004    4230944
## 5      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004   42605189
## 6      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004    4097829
##                                             concept_name          domain_id
## 1                                         Body structure Spec Anatomic Site
## 2                                       Buccal embrasure Spec Anatomic Site
## 3                    Skin structure of left lower eyelid Spec Anatomic Site
## 4                                          Adenofibrosis        Observation
## 5 Intervertebral foramen of eighteenth thoracic vertebra Spec Anatomic Site
## 6                            Transitional cell carcinoma        Observation
##       vocabulary_id  concept_class_id standard_concept    concept_code
## 1            SNOMED    Body Structure                S       123037004
## 2            SNOMED    Body Structure                S       110326006
## 3            SNOMED    Body Structure                S       719884003
## 4            SNOMED Morph Abnormality                S        89115006
## 5 SNOMED Veterinary    Body Structure                S 336621000009107
## 6            SNOMED Morph Abnormality                S        27090000
##   valid_start_date valid_end_date invalid_reason
## 1       1970-01-01     2099-12-31           &lt;NA&gt;
## 2       1970-01-01     2099-12-31           &lt;NA&gt;
## 3       2017-01-31     2099-12-31           &lt;NA&gt;
## 4       1970-01-01     2099-12-31           &lt;NA&gt;
## 5       2014-01-31     2099-12-31           &lt;NA&gt;
## 6       1970-01-01     2099-12-31           &lt;NA&gt;</code></pre>
<p>The ancestors are derived for those mCode concepts that excluded descendants.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">snomed_omop_library2b</span> <span class="op">&lt;-</span> <span class="va">snomed_omop_library1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ancestors_of</span><span class="op">)</span><span class="op">)</span>
<span class="va">snomed_omop_library2b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/join_for_ancestors.html">join_for_ancestors</a></span><span class="op">(</span>kind <span class="op">=</span> <span class="st">"LEFT"</span>, data <span class="op">=</span> <span class="va">snomed_omop_library2b</span>, 
    descendant_id_column <span class="op">=</span> <span class="st">"concept_id"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">min_levels_of_separation</span> <span class="op">!=</span> 
    <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">snomed_library</span><span class="op">)</span><span class="op">)</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"ancestor_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">rename_all</span><span class="op">(</span><span class="op">~</span><span class="fu">str_remove_all</span><span class="op">(</span><span class="va">.</span>, pattern <span class="op">=</span> <span class="st">"^ancestor_"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">snomed_omop_library2b2</span><span class="op">)</span></code></pre></div>
<pre><code>##                  value_set_name code_system
## 1 HistologyMorphologyBehaviorVS   SNOMED CT
## 2 HistologyMorphologyBehaviorVS   SNOMED CT
## 3 HistologyMorphologyBehaviorVS   SNOMED CT
## 4 HistologyMorphologyBehaviorVS   SNOMED CT
## 5 HistologyMorphologyBehaviorVS   SNOMED CT
## 6 HistologyMorphologyBehaviorVS   SNOMED CT
##                                                                                                                                          logical_definition
## 1 excludes codes descending from 399983006 | Papillary neoplasm, pancreatobiliary-type, with high grade intraepithelial neoplasia (morphologic abnormality)
## 2 excludes codes descending from 399983006 | Papillary neoplasm, pancreatobiliary-type, with high grade intraepithelial neoplasia (morphologic abnormality)
## 3 excludes codes descending from 399983006 | Papillary neoplasm, pancreatobiliary-type, with high grade intraepithelial neoplasia (morphologic abnormality)
## 4 excludes codes descending from 399983006 | Papillary neoplasm, pancreatobiliary-type, with high grade intraepithelial neoplasia (morphologic abnormality)
## 5 excludes codes descending from 399983006 | Papillary neoplasm, pancreatobiliary-type, with high grade intraepithelial neoplasia (morphologic abnormality)
## 6 excludes codes descending from 399983006 | Papillary neoplasm, pancreatobiliary-type, with high grade intraepithelial neoplasia (morphologic abnormality)
##   ancestors_of descendants_of code code_description all_codes concept_id
## 1    399983006           &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt; 399983006    4019483
## 2    399983006           &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt; 399983006    4030314
## 3    399983006           &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt; 399983006    4042149
## 4    399983006           &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt; 399983006    4043350
## 5    399983006           &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt; 399983006    4048384
## 6    399983006           &lt;NA&gt; &lt;NA&gt;             &lt;NA&gt; 399983006    4133294
##                        concept_name          domain_id vocabulary_id
## 1     Adenoma AND/OR adenocarcinoma        Observation        SNOMED
## 2                          Neoplasm        Observation        SNOMED
## 3               Epithelial neoplasm        Observation        SNOMED
## 4 Morphologically altered structure        Observation        SNOMED
## 5                    Body structure Spec Anatomic Site        SNOMED
## 6                  In situ neoplasm        Observation        SNOMED
##    concept_class_id standard_concept concept_code valid_start_date
## 1 Morph Abnormality                S    115215004       1970-01-01
## 2 Morph Abnormality                S    108369006       1970-01-01
## 3 Morph Abnormality                S    118285006       1970-01-01
## 4 Morph Abnormality                S    118956008       1970-01-01
## 5    Body Structure                S    123037004       1970-01-01
## 6 Morph Abnormality                S    127569003       1970-01-01
##   valid_end_date invalid_reason
## 1     2099-12-31           &lt;NA&gt;
## 2     2099-12-31           &lt;NA&gt;
## 3     2099-12-31           &lt;NA&gt;
## 4     2099-12-31           &lt;NA&gt;
## 5     2099-12-31           &lt;NA&gt;
## 6     2099-12-31           &lt;NA&gt;</code></pre>
<p>The concepts that are explicitly stated do not require any additional derivation.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">snomed_omop_library2c</span> <span class="op">&lt;-</span> <span class="va">snomed_omop_library1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">descendants_of</span><span class="op">)</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ancestors_of</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">snomed_omop_library2c</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 18
##   value_set_name code_system logical_definit… ancestors_of descendants_of code 
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;          &lt;chr&gt;
## 1 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           3636…
## 2 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           2524…
## 3 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           7110…
## 4 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           5880…
## 5 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           2507…
## 6 CancerDisease… SNOMED CT   &lt;NA&gt;             &lt;NA&gt;         &lt;NA&gt;           3863…
## # … with 12 more variables: code_description &lt;chr&gt;, all_codes &lt;chr&gt;,
## #   concept_id &lt;dbl&gt;, concept_name &lt;chr&gt;, domain_id &lt;chr&gt;, vocabulary_id &lt;chr&gt;,
## #   concept_class_id &lt;chr&gt;, standard_concept &lt;chr&gt;, concept_code &lt;chr&gt;,
## #   valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;, invalid_reason &lt;chr&gt;</code></pre>
<p>All 3 subsets are recombined before writing to file.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">snomed_omop_library</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">snomed_omop_library2a2</span>, <span class="va">snomed_omop_library2b2</span>, 
    <span class="va">snomed_omop_library2c</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">snomed_omop_library</span><span class="op">)</span></code></pre></div>
<pre><code>##         value_set_name code_system
## 1 CancerBodyLocationVS   SNOMED CT
## 2 CancerBodyLocationVS   SNOMED CT
## 3 CancerBodyLocationVS   SNOMED CT
## 4 CancerBodyLocationVS   SNOMED CT
## 5 CancerBodyLocationVS   SNOMED CT
## 6 CancerBodyLocationVS   SNOMED CT
##                                          logical_definition ancestors_of
## 1 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 2 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 3 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 4 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 5 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
## 6 includes codes descending from 123037004 | Body Structure         &lt;NA&gt;
##   descendants_of code code_description all_codes concept_id
## 1      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004    4048384
## 2      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004    4002852
## 3      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004   36717763
## 4      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004    4230944
## 5      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004   42605189
## 6      123037004 &lt;NA&gt;             &lt;NA&gt; 123037004    4097829
##                                             concept_name          domain_id
## 1                                         Body structure Spec Anatomic Site
## 2                                       Buccal embrasure Spec Anatomic Site
## 3                    Skin structure of left lower eyelid Spec Anatomic Site
## 4                                          Adenofibrosis        Observation
## 5 Intervertebral foramen of eighteenth thoracic vertebra Spec Anatomic Site
## 6                            Transitional cell carcinoma        Observation
##       vocabulary_id  concept_class_id standard_concept    concept_code
## 1            SNOMED    Body Structure                S       123037004
## 2            SNOMED    Body Structure                S       110326006
## 3            SNOMED    Body Structure                S       719884003
## 4            SNOMED Morph Abnormality                S        89115006
## 5 SNOMED Veterinary    Body Structure                S 336621000009107
## 6            SNOMED Morph Abnormality                S        27090000
##   valid_start_date valid_end_date invalid_reason
## 1       1970-01-01     2099-12-31           &lt;NA&gt;
## 2       1970-01-01     2099-12-31           &lt;NA&gt;
## 3       2017-01-31     2099-12-31           &lt;NA&gt;
## 4       1970-01-01     2099-12-31           &lt;NA&gt;
## 5       2014-01-31     2099-12-31           &lt;NA&gt;
## 6       1970-01-01     2099-12-31           &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"snomed.csv"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">snomed_omop_library</span>, file <span class="op">=</span> <span class="va">file</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Error in open.connection(file, "wb"): cannot open the connection</code></pre>
</div>
<div id="loinc" class="section level2">
<h2 class="hasAnchor">
<a href="#loinc" class="anchor"></a>LOINC</h2>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loinc_library</span> <span class="op">&lt;-</span> <span class="va">value_sets_by_vocab</span><span class="op">$</span><span class="va">LOINC</span> <span class="op">%&gt;%</span> <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/format_colnames.html">format_colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate_all</span><span class="op">(</span><span class="va">as.character</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate_all</span><span class="op">(</span><span class="va">trimws</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">loinc_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   value_set_name  code_system logical_definiti… code  code_description          
##   &lt;chr&gt;           &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;                     
## 1 TumorMarkerTes… LOINC       &lt;NA&gt;              1695… 5-Hydroxyindoleacetate [M…
## 2 TumorMarkerTes… LOINC       &lt;NA&gt;              3120… 5-Hydroxyindoleacetate [M…
## 3 TumorMarkerTes… LOINC       &lt;NA&gt;              1692… 5-Hydroxyindoleacetate [M…
## 4 TumorMarkerTes… LOINC       &lt;NA&gt;              1693… 5-Hydroxyindoleacetate [M…
## 5 TumorMarkerTes… LOINC       &lt;NA&gt;              1694… 5-Hydroxyindoleacetate [M…
## 6 TumorMarkerTes… LOINC       &lt;NA&gt;              7282… 5-Hydroxyindoleacetate [M…</code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loinc_omop_library</span> <span class="op">&lt;-</span> <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/join_on_concept_code.html">join_on_concept_code</a></span><span class="op">(</span>kind <span class="op">=</span> <span class="st">"LEFT"</span>, 
    data <span class="op">=</span> <span class="va">loinc_library</span>, column <span class="op">=</span> <span class="st">"code"</span>, where_in_concept_field <span class="op">=</span> <span class="st">"vocabulary_id"</span>, 
    where_in_concept_field_value <span class="op">=</span> <span class="st">"LOINC"</span><span class="op">)</span>
<span class="va">loinc_omop_library</span> <span class="op">&lt;-</span> <span class="va">loinc_library</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">loinc_omop_library</span>, 
    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"value_set_name"</span>, <span class="st">"code_system"</span>, <span class="st">"logical_definition"</span>, 
        <span class="st">"code"</span>, <span class="st">"code_description"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">loinc_omop_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 15
##   value_set_name code_system logical_definit… code  code_description concept_id
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
## 1 TumorMarkerTe… LOINC       &lt;NA&gt;             1695… 5-Hydroxyindole…    3005148
## 2 TumorMarkerTe… LOINC       &lt;NA&gt;             3120… 5-Hydroxyindole…    3023028
## 3 TumorMarkerTe… LOINC       &lt;NA&gt;             1692… 5-Hydroxyindole…    3014670
## 4 TumorMarkerTe… LOINC       &lt;NA&gt;             1693… 5-Hydroxyindole…    3021106
## 5 TumorMarkerTe… LOINC       &lt;NA&gt;             1694… 5-Hydroxyindole…    3021385
## 6 TumorMarkerTe… LOINC       &lt;NA&gt;             7282… 5-Hydroxyindole…   43055680
## # … with 9 more variables: concept_name &lt;chr&gt;, domain_id &lt;chr&gt;,
## #   vocabulary_id &lt;chr&gt;, concept_class_id &lt;chr&gt;, standard_concept &lt;chr&gt;,
## #   concept_code &lt;chr&gt;, valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;,
## #   invalid_reason &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"loinc.csv"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">loinc_omop_library</span>, file <span class="op">=</span> <span class="va">file</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Error in open.connection(file, "wb"): cannot open the connection</code></pre>
</div>
<div id="icd-10-cm" class="section level2">
<h2 class="hasAnchor">
<a href="#icd-10-cm" class="anchor"></a>ICD-10 CM</h2>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">icd10cm_library</span> <span class="op">&lt;-</span> <span class="va">value_sets_by_vocab</span><span class="op">$</span><span class="va">`ICD-10-CM`</span> <span class="op">%&gt;%</span> <span class="fu">rubix</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/rubix/reference/format_colnames.html">format_colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate_all</span><span class="op">(</span><span class="va">as.character</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate_all</span><span class="op">(</span><span class="va">trimws</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>code <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span>string <span class="op">=</span> <span class="va">code</span>, 
    pattern <span class="op">=</span> <span class="st">"(^[A-Z]{1}[0-9A-Z]{2})([0-9A-Z]{1}.*$)"</span>, replacement <span class="op">=</span> <span class="st">"\\1.\\2"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">icd10cm_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   value_set_name  code_system logical_definiti… code  code_description          
##   &lt;chr&gt;           &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;                     
## 1 CancerDisorder… ICD-10-CM   &lt;NA&gt;              C00.0 Malignant neoplasm of ext…
## 2 CancerDisorder… ICD-10-CM   &lt;NA&gt;              C00.1 Malignant neoplasm of ext…
## 3 CancerDisorder… ICD-10-CM   &lt;NA&gt;              C00.2 Malignant neoplasm of ext…
## 4 CancerDisorder… ICD-10-CM   &lt;NA&gt;              C00.3 Malignant neoplasm of upp…
## 5 CancerDisorder… ICD-10-CM   &lt;NA&gt;              C00.4 Malignant neoplasm of low…
## 6 CancerDisorder… ICD-10-CM   &lt;NA&gt;              C00.5 Malignant neoplasm of lip…</code></pre>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">icd10cm_omop_library</span> <span class="op">&lt;-</span> <span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/join_on_concept_code.html">join_on_concept_code</a></span><span class="op">(</span>kind <span class="op">=</span> <span class="st">"LEFT"</span>, 
    data <span class="op">=</span> <span class="va">icd10cm_library</span>, column <span class="op">=</span> <span class="st">"code"</span>, where_in_concept_field <span class="op">=</span> <span class="st">"vocabulary_id"</span>, 
    where_in_concept_field_value <span class="op">=</span> <span class="st">"ICD10CM"</span><span class="op">)</span>
<span class="va">icd10cm_omop_library</span> <span class="op">&lt;-</span> <span class="va">icd10cm_library</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">icd10cm_omop_library</span>, 
    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"value_set_name"</span>, <span class="st">"code_system"</span>, <span class="st">"logical_definition"</span>, 
        <span class="st">"code"</span>, <span class="st">"code_description"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">icd10cm_omop_library</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 15
##   value_set_name code_system logical_definit… code  code_description concept_id
##   &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;
## 1 CancerDisorde… ICD-10-CM   &lt;NA&gt;             C00.0 Malignant neopl…   35206047
## 2 CancerDisorde… ICD-10-CM   &lt;NA&gt;             C00.1 Malignant neopl…   35206048
## 3 CancerDisorde… ICD-10-CM   &lt;NA&gt;             C00.2 Malignant neopl…   35206049
## 4 CancerDisorde… ICD-10-CM   &lt;NA&gt;             C00.3 Malignant neopl…   35206050
## 5 CancerDisorde… ICD-10-CM   &lt;NA&gt;             C00.4 Malignant neopl…   35206051
## 6 CancerDisorde… ICD-10-CM   &lt;NA&gt;             C00.5 Malignant neopl…   35206052
## # … with 9 more variables: concept_name &lt;chr&gt;, domain_id &lt;chr&gt;,
## #   vocabulary_id &lt;chr&gt;, concept_class_id &lt;chr&gt;, standard_concept &lt;chr&gt;,
## #   concept_code &lt;chr&gt;, valid_start_date &lt;date&gt;, valid_end_date &lt;date&gt;,
## #   invalid_reason &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"icd10cm.csv"</span><span class="op">)</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> <span class="va">icd10cm_omop_library</span>, file <span class="op">=</span> <span class="va">file</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Error in open.connection(file, "wb"): cannot open the connection</code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">chariot</span><span class="fu">::</span><span class="fu"><a href="https://meerapatelmd.github.io/chariot/reference/dcAthena.html">dcAthena</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Meera Patel, MD.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
